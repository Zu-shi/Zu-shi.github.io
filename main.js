// Todo: have a global that gets the x, y, width, height of preview box at any moment
var Events = [{"Name":"Ground of Being","Poem":"There is a ground of being that all things grow from.\nThe ground is here and now","X":8258,"Y":2249,"Radius":1450},{"Name":"Wings in Self-Strum","Poem":"Chords carrying the Will of Quanta.\nThere is music that plays itself.","X":4666,"Y":2614,"Radius":1450},{"Name":"Wondercloud","Poem":"The Wondercloud holds an infinite number of stars. But you could only see that if you were all of them.\nHere wonder percipitates at the dew point of dreams.Look how it doooooo!","X":7747,"Y":2825,"Radius":940},{"Name":"Conversation of Quanta","Poem":"What there is has a lot to say, and always in familiar tone. Sopken in a language convergent toward common ground.\nThe ground of being, here and now.","X":959,"Y":3056,"Radius":940},{"Name":"Burst of Solar Structure","Poem":"Solar Structures Rise\nThe passing of forces in disguise","X":12199,"Y":2124,"Radius":940},{"Name":"Far Off Emergence","Poem":"Suddently it\u2019s Here\nThere it goes.","X":1069,"Y":1393,"Radius":940},{"Name":"Opalescence Presence","Poem":"Glimmering here, now\nIridescent and ever shifting","X":11261,"Y":1402,"Radius":940},{"Name":"Architecture","Poem":"Articulate designs hittings foundational notes]nThey hum in unison","X":4303,"Y":2268,"Radius":940},{"Name":"Unfathomable Quanta","Poem":"It is how it is measured\nHow strange","X":10602,"Y":4411,"Radius":940},{"Name":"Boundless Being","Poem":"Where thing becomes no-thing but thereness is undeniable.\nHere, thoughts take form where forms take thought.","X":8482,"Y":3225,"Radius":940},{"Name":"Layer and Structure","Poem":"The building of thing-ness. It is present when seen.\nWhen out of site, There is no speaking of it","X":3547,"Y":3580,"Radius":940},{"Name":"Here and Now","Poem":"A twist of fate always making history\nBut never bound by it","X":2564,"Y":1857,"Radius":940},{"Name":"Sub-Surface Covergence","Poem":"Segmented but congruent\nA localized expression of a universal whole.","X":2259,"Y":956,"Radius":940},{"Name":"In-Breath","Poem":"The awareness machine weaves consciousness\nIt\u2019s inbreath threading through and finding new.","X":11715,"Y":982,"Radius":940},{"Name":"Awareness Machine","Poem":"The Awareness Machine conjures it\u2019s pretend occurrence. A projected intention collides with Waveform.\nDestructive interference.","X":10015,"Y":1736,"Radius":940},{"Name":"Feminine Aspect","Poem":"It loves and nourishes all but does not lord it over them. When feats are accomplished it lays no claim to them.\n-Lao Tzu","X":10515,"Y":1700,"Radius":940},{"Name":"Convergence of Spirit","Poem":"the wafting of the wind sings a Song of the Soul. vibrations from waveforms expressing rhythms of the heart.\nThe seed of intention grows an undercurrent that always finds its way. A vision of Unity.","X":8441,"Y":2317,"Radius":940},{"Name":"Preceding Quanta","Poem":"the self-assembly finding base form.\nA spiral.","X":15399,"Y":958,"Radius":940},{"Name":"Out-Breath","Poem":"an outbreath pushes surrounding atmosphere creating currents.\nThe Preceding Quanta is self-assembling.","X":13543,"Y":1056,"Radius":940},{"Name":"Waves of Ether Into Base Quanta","Poem":"the wafting of fundamental essence\nCurrents in constant arrival.","X":14002,"Y":3433,"Radius":940},{"Name":"Proof of Sun","Poem":"Immense energy at work. Making poetry from earth","X":7595,"Y":1945,"Radius":550},{"Name":"Convergence Engine","Poem":"Nebulous matter seeks the Convergence Engine. By Courteously of constructive resonance.\nMatter takes form.","X":11323,"Y":2046,"Radius":550},{"Name":"Seed of Intention","Poem":"The Seed of Intention sprouts with the passing of a wave form. The frequency of interaction is ever evolving.\nThere is no predicting which way it will grow.","X":9476,"Y":2662,"Radius":550},{"Name":"Livid Life","Poem":"Livid with life, fresh and full of potential.\nThe possibility field is dense and teeming.","X":7904,"Y":757,"Radius":550},{"Name":"Dance of Duality","Poem":"The rise and origin of meaning. Here, the darkness is a function of the light.\nThe self-implying other. The elemental spirit of relativity","X":8628,"Y":1344,"Radius":550},{"Name":"Season of Artificial Intelligence","Poem":"Consciousness takes on yet another persona. A Season of Artififical Intelligence emerges\nas companion to Boundless Curiosity","X":7445,"Y":3397,"Radius":550},{"Name":"Life of Leaf","Poem":"The last leaf hangs on as a season of artificial intelegence begins.\nA Life line","X":6844,"Y":3444,"Radius":550},{"Name":"Open Hear","Poem":"It is the ear that envokes riviting sound from what would otherwise be sterile vibration\nHear it? Musical matters finding their way to an open ear. Can you hear it?","X":10816,"Y":3338,"Radius":550},{"Name":"Wave Form","Poem":"There is always waving. Wave back before it passes\nThe hand of phenomenon Always waving, Always passing","X":10295,"Y":1956,"Radius":550},{"Name":"Helix of Intertwining Self and Other","Poem":"The weaving of intnetions into words\nEchos of conversation transcending the boundaries of self and other.","X":6499,"Y":2547,"Radius":550},{"Name":"Friction Formula","Poem":"Coefficients of conflict play rough for a moment.A formula for friction emerges.\nA clash of matter-proving substance. Intimate entanlement","X":968,"Y":3383,"Radius":550},{"Name":"Fading Architecture, Entropy Affecter","Poem":"Transient architecture fading into elemental material.\nA pattern at its half-life.","X":4092,"Y":602,"Radius":550},{"Name":"Life Line","Poem":"A pluse.....between scilence.....a pulse.....","X":7577,"Y":3715,"Radius":550},{"Name":"Wisps of Sight","Poem":"seeking, seeing, making waves and currents in the see.","X":2364,"Y":3636,"Radius":550},{"Name":"Duality Bites","Poem":"Yin yang cookies, a staple of any diet.\nEven if you\u2019venever had them, you have!","X":10617,"Y":2196,"Radius":550},{"Name":"Dimensional Breach","Poem":"a lower dimensions spontaneous blink.\nThe information appears flat","X":6160,"Y":1388,"Radius":550},{"Name":"Horn of Musical Matters","Poem":"Winds reverberate the horn.\nMusical matters begin.","X":10202,"Y":2630,"Radius":550},{"Name":"Cloud Form","Poem":"The oceans baby producing the OG vape. The rain daddy. The river mama. The atmospheric sensation, lazing, hazing, AMAZING!\nThat Before the dreams take shape, they are diaphanous in form.","X":5050,"Y":1156,"Radius":550},{"Name":"The Floop of Fwee","Poem":"WEEEEEEEEEEEEEEEEEEEEEE!<3 XD!","X":5641,"Y":3975,"Radius":550},{"Name":"Luminous Wing","Poem":"A Luminous Wing gracing through deep blue.\nIt\u2019s shimmer comes in oscillations","X":6425,"Y":1785,"Radius":550},{"Name":"Boundless Being","Poem":"Where Thing becomes no-thing yet there-ness persists.\nThoughts take form where forms take thought.","X":8262,"Y":3375,"Radius":550},{"Name":"Song of the Soul","Poem":"A song of the soul plays over the convergence of spirit.\nHitting notes of unity.","X":8223,"Y":1737,"Radius":550},{"Name":"Diaphanous Games with Cumulous Intent","Poem":"A cumulous of intention is about to reach dew point.\nIt plays chords of constructive resonance to projected intentions.","X":11051,"Y":2246,"Radius":550},{"Name":"Airfoil","Poem":"Dynamics of deep blue lancing through to open air","X":6478,"Y":2004,"Radius":550},{"Name":"Sense Alchemy","Poem":"Sensational sorcery in action. New feelings are forged and pass through here every moment.\nThe awareness machine selects which ones will fuel the next projected intention.","X":9185,"Y":1533,"Radius":550},{"Name":"Sleek Curiosity","Poem":"Curiosities feel no friction here.\nAn eternal youthful game of inquiries.","X":8644,"Y":3121,"Radius":550},{"Name":"Pretend Occurrence","Poem":"The awareness machine conjures an image of the self. A cleverly selective guiding system. An ego playing pretend.\nA pretend occurrence who is a self-labeling master of nomenclature.","X":9855,"Y":1530,"Radius":550},{"Name":"Stratified Conscious Side","Poem":"The whirling  Dance of Duality stratifies meaning\nProof of dreaming","X":8777,"Y":1141,"Radius":550},{"Name":"Gestures of Rhythm","Poem":"The passing of Periotic Possibility\nWaving hello, Waning goodbye","X":6353,"Y":2843,"Radius":550},{"Name":"Flutter Form","Poem":"Form Flutters","X":4366,"Y":2595,"Radius":550},{"Name":"Feeling Fumes","Poem":"The exhaust of Sense Alchemy.\nA whiff for shift. Feel the lift?","X":9660,"Y":1935,"Radius":550},{"Name":"Vertex Convergence, Context Emergence","Poem":"Ribbons of texture come together under circumstance\nThere is conversation presiding over the Helix of Intertwining Self and Other","X":6719,"Y":2223,"Radius":550},{"Name":"Melodic Action","Poem":"While the high Octane experience is racing, melodic action turns the sound into song.\nTaking flight on a Luminous Wing","X":6737,"Y":1417,"Radius":550},{"Name":"Wedge of Transience","Poem":"Transience is wedged beneath the Tree of Life","X":7058,"Y":2468,"Radius":550},{"Name":"Wafts of Vision","Poem":"Responding to currents of sight\nSeeking, seeing, making waves and curents in the see","X":558,"Y":3893,"Radius":550},{"Name":"Twinkling \"I\"","Poem":"Spectral radiance from afar, captured by reaching eyes. When the stars shine so does \u201cI\u201d\nThe Twinckle Is in the \u201cI\u201d, Yours and Mine","X":6089,"Y":1679,"Radius":275},{"Name":"Wriggle of Spirit","Poem":"There is will, and there will be way","X":8653,"Y":1823,"Radius":275},{"Name":"Artifacts of spirit","Poem":"They find rhythum with Occam\u2019s Razor\nThe rest is up to song and dance","X":4966,"Y":2718,"Radius":275},{"Name":"The Grey","Poem":"Black and white come to an agreement.\nThe result is a grey area","X":6134,"Y":2414,"Radius":275},{"Name":"Frequent-See","Poem":"How often? How far between? Low or high?\nA frequent-see passes over the seed of intention.","X":9542,"Y":2686,"Radius":275},{"Name":"Motion-Forge Radical","Poem":"What it is cannot be spoken. Only available in motion\nA radical in passing","X":5776,"Y":2296,"Radius":275},{"Name":"Perk of Will","Poem":"Nestled against the seed of intention, it inherits streaking color\nA perk of will","X":9312,"Y":2484,"Radius":275},{"Name":"Illusive bridge","Poem":"A notion has found cause, A bridge to effect.\nThere is affect.","X":5756,"Y":1588,"Radius":275},{"Name":"Occam's Razor","Poem":"The sharp wit of reason,  simple and concise\nOn the weekends it joins the spirit of song and dance.","X":5144,"Y":2576,"Radius":275},{"Name":"Support Agent","Poem":"Form acting as a support agent to a cyclical Life Line","X":7069,"Y":3733,"Radius":275},{"Name":"The Shadow Self","Poem":"Brushes up against the seed of intention. Its ripple influencing the form of intention.\nThe Wave Form waves at ths flux in acknowledgement.","X":9940,"Y":2612,"Radius":275},{"Name":"The Point","Poem":"What is the point? this is it.\nHere it is, noow it is, this is it","X":8414,"Y":300,"Radius":275},{"Name":"Elemental Flux","Poem":"The constituents preceding sense alchemy.\nFleeting feeling, networking to get a feel of the senses.     ","X":9454,"Y":1373,"Radius":275},{"Name":"High Octane Experience","Poem":"Breaching into foreign fields, The raw experience sees the unseen, hears the unheard.\nA refreshing rate and resolution","X":6644,"Y":1144,"Radius":275},{"Name":"Shine Refinery","Poem":"Make it shine, make it fine\nMake it mine.","X":8547,"Y":2832,"Radius":275},{"Name":"Wink By Gleaming Glint","Poem":"Allured by feeling fumes\nA wriggling glit passes, giving a wink","X":9765,"Y":2094,"Radius":275},{"Name":"Cubic Kiss","Poem":"The Architect has calculated a kiss.\nFirmly planted and unwavering.","X":5009,"Y":2902,"Radius":275},{"Name":"Propagation Artifact","Poem":"A bloom of propagation,\nProlific intention gives arise to the Awareness Machine.","X":9447,"Y":1685,"Radius":275},{"Name":"Tree of Life","Poem":"The ground of being takes ascension with riveting growth.\nBeginning simple and growing complex. What is fruitful goes on","X":7112,"Y":2264,"Radius":275},{"Name":"Rhythm of Self-Assembly","Poem":"Growth takes form, playing a game of self-assembly.","X":6335,"Y":3511,"Radius":275},{"Name":"love Language","Poem":"Enchanted by the fumes of sense alchemy, an off shoot is intoxicated","X":8867,"Y":920,"Radius":275},{"Name":"Percussive Lifeforce","Poem":"A leap of faith, A Spring for life, A burst of force","X":7883,"Y":1407,"Radius":275},{"Name":"Charming Veneer","Poem":"Under cover of cute","X":5106,"Y":2193,"Radius":275},{"Name":"Space Thread","Poem":"It is space that implies substance. The Background that implies foreground\nThe self that implies the other, they are woven","X":7433,"Y":1395,"Radius":275}];
var EventHitboxesNormalized = []
console.log(Events);

// box = 1374x334
// start point = 1232x256
// 3840x2160

var web = new Image();
web.onload = function(){
	RedrawCanvas();
}
web.src = 'Assets\\BBB_website_design_4k.webp';

var decorative = new Image();
decorative.onload = function(){
	RedrawCanvas();
}
decorative.src = 'Assets\\CCC_Decorative_Elements.webp';

var scrollbackground = new Image();
scrollbackground.onload = function(){
	RedrawCanvas();
}
scrollbackground.src = 'Assets\\Brackground for Scroll List.webp';

var looking_glass = new Image();
looking_glass.onload = function(){
	RedrawCanvas();
}
looking_glass.src = 'Assets\\EEE_Looking_Glass_No_Vert_Bar.webp';

var unity = new Image();
unity.onload = function(){
	RedrawCanvas();
}
unity.src = 'Assets\\AAA_We_Are_Unity_(WebP 90_).webp';

var scrollBar = new Image();
scrollBar.onload = function(){
	RedrawCanvas();
}
scrollBar.src = 'Assets\\Scroll List Scroll Bar.webp';

/*
var eventFont = new FontFace('myFont', 'url(Assets\\GABRIOLA.TTF)');
eventFont.load().then(function(font){
  // with canvas, if this is ommited won't work
  document.fonts.add(font);
  console.log('Font loaded');
});
*/

const overall_width = 3840
const overall_height = 2160
const overall_box_startx = 1232
const overall_box_starty = 256
const box_width = 1382
const box_height = 334
const aspect_ratio = overall_width / overall_height;

const circle_center_x = 1920
const circle_center_y = 1200
const circle_radius = 420
const unity_width = 16295
const unity_height = 4000

const event_coords_ratio = 0.88186

const min_width = 1280
const min_height = 720

let beforeFirstOrderChangeEver = true;
let currently_in_box = false
let reordering_menu_dissapeared = true
let cached_event_ordering = []
let oddlist = []
let evenlist = []
let oddlist_cached = []
let evenlist_cached = []
let cachedEvent = {clientX: 0, clientY: 0}

let current_fps_second = 0;
let frames_kept = 0;
let current_fps = 0;

let reorderingMenuAlphaTimers = [];

/*
const ms_per_second = 1000;
const refresh_interval = 1 * ms_per_second;
const fade_in_out_interval = 0.4;
*/

let last_refresh_time_ms = Date.now();
let last_change_time_ms = Date.now();
let last_mouse_move_time_ms = Date.now();
const recheck_interval_ms = 100
const wait_mouse_still_seconds_for_list_change = 200
const fade_out_ms = 400
const fade_in_ms = 400
let beforefirstchange = false;
let beforesecondchange = false;
let beforefirstrefresh = false;
let beforefirstdidnotchange = false;

let reordering_menu_alpha = 1;
let ordered_menu_alpha = 1;
let ordered_menu_poem_alpha = 0;

let reordering_menu_alpha_target = 1;
let ordered_menu_alpha_target = 1;
let ordered_menu_poem_alpha_target = 0;
const alpha_menu_change_speed = 0.07;

var getTextHeight = function(font) {

  var text = $('<span>Hg</span>').css({ fontFamily: font });
  var block = $('<div style="display: inline-block; width: 1px; height: 0px;"></div>');

  var div = $('<div></div>');
  div.append(text, block);

  var body = $('body');
  body.append(div);

  try {
    var result = {};

    block.css({ verticalAlign: 'baseline' });
    result.ascent = block.offset().top - text.offset().top;

    block.css({ verticalAlign: 'bottom' });
    result.height = block.offset().top - text.offset().top;

    result.descent = result.height - result.ascent;
  } finally {
    div.remove();
  }

  return result;
}
  
function DrawImage(ctx, img, x, y, width, height)
{
	ctx.drawImage(img.width, img.height, x, y, width, height)
}

function DrawImageCentered(ctx, img, x, y, width, height)
{
	ctx.drawImage(img, x - width / 2, y - height / 2, width, height)
}

function DrawCircle(ctx, x, y, radius, color)
{
	console.log(x, y, radius)
	ctx.globalAlpha = 0.3;
	ctx.strokeStyle = '#FFFFFF'
	ctx.lineWidth = 2
	ctx.beginPath();
	ctx.arc(x, y, radius, 0, 2 * Math.PI);
	ctx.stroke();
	ctx.globalAlpha = 1;
}

function DrawCross(ctx, x, y, radius, color)
{
	console.log(x, y, radius)

	ctx.moveTo(x - radius, y);
	ctx.lineTo(x + radius, y);

	ctx.moveTo(x, y - radius);
	ctx.lineTo(x, y + radius);

	//ctx.beginPath();
	//ctx.arc(x, y, radius, 0, 2 * Math.PI);
	//ctx.stroke();
}

function GetMainRegion(c)
{
	var ctx = c.getContext("2d");

	bodyHeight = Math.max(c.height, min_height);
	bodyWidth = c.width;

	var bodyRatio = bodyWidth / bodyHeight;
	// console.log(bodyWidth, bodyHeight);


	// We need to create a scrollbar to use
	// In the case that width is smaller than implied by height, then the width is equal to ratio to height.
	// In the case that the width is higher, then a scrollbar is not needed.
	$("#scrollbox").width(bodyHeight * bodyRatio).height(bodyHeight);
	$("#scrollbox").width(1080).height(720);

	// Center the body horizontally by calculating the width of the image
	var new_overall_width = bodyHeight / overall_height * overall_width;
	
	// The height is just height of HTML
	var new_overall_height = bodyHeight;

	var x = 0;
	if (bodyRatio > aspect_ratio)
	{
		// If page ratio is greather than background ratio, we have horizontal spaces
		// The space you should give is (bodyRatio - Aspect_Ratio) / 2 * new_overall_height
		x = (bodyRatio - aspect_ratio) / 2 * new_overall_height;
	}

	var obj = {
	    x: x,
	    y: 0,
	   	width: new_overall_width,
	    height: new_overall_height,
	};

	//console.log("regionx: ", x, " regionheight: ", new_overall_height)

	return obj;
}

// Returns box mouse position. Take input from box normalized coords.
function GetMouseCoordsFromBoxNormalizedCoords(c, x_n, y_n)
{
	var yratio = c.height / overall_height;
	var xratio = yratio;
	var yboxposition = yratio * overall_box_starty;
	var xboxposition = xratio * overall_box_startx;

	var r = GetMainRegion(c);
	var obj = {
	    x: r.x + xboxposition + x_n * xratio * box_width,
	    y: r.y + yboxposition + y_n * yratio * box_height,
	};

	return obj;
}


// Returns 0 to 1 in whole region normalized coordinates. Take input mouse coords.
function GetNormalizedCoordsFromMouseCoords(c, mouse_x, mouse_y)
{
	var r = GetMainRegion(c);
	var xposition = (mouse_x - r.x) / r.width;
	var yposition = (mouse_y - r.y) / c.height;

	var obj = {
	    x: xposition,
	    y: yposition,
	};

	return obj;
}

// Returns 0 to 1 in boxed coordinates. Take input from mouse positions.
function GetNormalizedBoxCoordsFromMouseCoords(c, mouse_x, mouse_y)
{
	var r = GetMainRegion(c);
	var yratio = r.height / overall_height;
	var xratio = yratio;

	// Note: don't get x and y confused.
	var xposition = xratio * overall_box_startx;
	var yposition = yratio * overall_box_starty;

	var xs = (mouse_x - (r.x + xposition)) / (xratio * box_width);
	var ys = (mouse_y - (r.y + yposition)) / (yratio * box_height);

	//console.log(mouse_x, mouse_y, xposition, yposition, xratio, yratio)

	var obj = {
		x: xs,
		y: ys,
	};

	return obj;
}

// Returns whether in box.
function IsInBox(c, mouse_x, mouse_y)
{
	var coords = GetNormalizedBoxCoordsFromMouseCoords(c, mouse_x, mouse_y);
	//console.log(coords.x, coords.y)
	return coords.x > 0 && coords.x < 1 && coords.y > 0 && coords.y < 1;
}

function DrawScrollArea(c)
{
	var ctx = c.getContext("2d");
	ctx.drawImage(scrollbackground, r.x, r.y, r.width, r.height);

	var ctx = c.getContext("2d");
	startxy = GetMainRegion(c);

	// Shadow starts at 340
	// Let font size remain the same
	const full_start_location_x = 340
	starty = startxy.y + 30;
	font_size = 20;
	starting_location_x = full_start_location_x / overall_width * startxy.width + startxy.x;

	EventHitboxes = []

	ctx.fillStyle = "#eeeeee";

	ctx.globalAlpha = 0.7 * ordered_menu_alpha;
	for (let i in Events)
	{
		//ctx.font = "lighter " + text_size_to_body_ratio + "px Times New Roman";ctx.font = "lighter " + text_size_to_body_ratio + "px Times New Roman";
		ctx.font = "lighter " + font_size + "px Gabriola";
		ctx.fillText(Events[i]["Name"], starting_location_x, starty);
		starty += (font_size * 2);
	}

	ctx.globalAlpha = 1;
}

function GetDistance(x1, y1, x2, y2)
{
	return Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2)
}

let n = 0;
let m = 0;

// Clamp number between two values with the following line:
const clamp = (num, min, max) => Math.min(Math.max(num, min), max);


var isTimerOn = false;
var allowForOrderChange = false;
function myTimer() {
	reordering_menu_alpha_target = 1;
	isTimerOn = false;
	allowForOrderChange = true;
  // const d = new Date();
  // document.getElementById("demo").innerHTML = d.toLocaleTimeString();
  // KickoffAlphaChange.
  // Idea: change alpha on the first stop?
  reorderingMenuAlphaTimers.shift();


	beforeFirstOrderChangeAfterRefresh = true;
}

function DrawPoem(c, index, alpha)
{
	var ctx = c.getContext("2d");
	startxy = GetMainRegion(c);

	ctx.fillStyle = "#eeeeee";
	
	startyTitle = 1848 / overall_height * startxy.height;
	startyPoem = 1903 / overall_height * startxy.height;
	startx = startxy.x + 1920 / overall_width * startxy.width 

	ctx.textAlign = 'center';
	ctx.globalAlpha = alpha;
	var font = "lighter " + 32 + "px Gabriola";
	ctx.font = font;
	ctx.fillText(Events[index]["Name"], startx, startyTitle);


	// 1080 / 26 = 42
	var font = "lighter " + overall_height / 100 + "px Gabriola";
	ctx.font = font;

  var texts = Events[index]["Poem"].split("\n");
  for (i in texts)
  {
		ctx.fillText(texts[i], startx, startyPoem);
		startyPoem += overall_height / 100 + 4;
	}

	// var measureText = ctx.measureText(Events[oddlist_cached[i]["index"]]["Name"]);
}

function DrawReorderingArea(c)
{
	var ctx = c.getContext("2d");
	startxy = GetMainRegion(c);

	// Shadow starts at 380
	// Let font size remain the same
	const full_centering_location_x = 380
	starty = startxy.y + 30;
	centering_location_x = full_centering_location_x / overall_width * startxy.width + startxy.x; 

	ctx.globalAlpha = 0.7;
	// Get distance
	
	let current_time_ms = Date.now();
	
	if (!IsInBox(c, mouse_unbounded_pos_x, mouse_unbounded_pos_y))
	{
		// console.log("out of box")
		currently_in_box = false;
		allowForOrderChange = false;
		reordering_menu_alpha_target = 0;
		ordered_menu_alpha_target = 1;

		// Cancel existing timers
		for (timer in reorderingMenuAlphaTimers)
		{
			clearTimeout(timer);
		}
		reorderingMenuAlphaTimers = [];
	}
	else
	{
		ordered_menu_poem_alpha_target = 0
		clearTimeout(poem_change_timer);

		// console.log("in box")

		// Move unity preview location
		let mouse = getMousePosition(cachedEvent);
		let normalizedPos = GetNormalizedCoordsFromMouseCoords(c, mouse_inbox_target_pos_x, mouse_inbox_target_pos_y);
		let unityPosX = normalizedPos.x * unity_width
		let unityPosY = normalizedPos.y * unity_height

		// Immediately fade out ordered menu.
		ordered_menu_alpha_target = 0;

		if (cached_event_ordering.length == 0)
		{
			// one-time initialization of original lists.
				
			// Push all events to a default list.
			cached_event_ordering = []
			for (let i = 0; i < Events.length; i++)
			{
				// Note: distance is likely not needed here.
				var dist = GetDistance(Events[i]["X"] * event_coords_ratio, Events[i]["Y"] * event_coords_ratio, unityPosX, unityPosY);
				var item = {"index": i, "distance": dist};
				cached_event_ordering.push(item);
			}

			// Create new default ordering (this needs to happen after mouse stops moving).
			// Create temporary lists
			oddlist = []
			evenlist = []

			for (let i = 0; i < cached_event_ordering.length; i++)
			{
				i % 2 == 0 ? evenlist.push(cached_event_ordering[i]) : oddlist.push(cached_event_ordering[i]);
			}
		}


		if (!currently_in_box)
		{
			// Just enterted box
			currently_in_box = true;

			if (!isTimerOn)
			{
				isTimerOn = true;
				// reorderingMenuAlphaTimers.push(setTimeout(myTimer, 800));
				reorderingMenuAlphaTimers.push(setTimeout(myTimer, 600));
			}
		}


		beforefirstchange = true;
		beforefirstrefresh = true;
		beforesecondchange = true;
		beforefirstdidnotchange = true;
		
		// Note: if this doesn't work go with a totally alarm based approach.
		if (allowForOrderChange) 
		{
			// This means that the timer is up, we can start ordering events now.

			// Use timing determine whether to recheck for distance
			if ((current_time_ms - last_refresh_time_ms) > recheck_interval_ms)
			{
				last_refresh_time_ms = current_time_ms;

				// Look for mouse stops
				if (current_time_ms - last_mouse_move_time_ms > wait_mouse_still_seconds_for_list_change)
				{
					// Duplicate lists
					let oddlist_temp = JSON.parse(JSON.stringify(oddlist));
					let evenlist_temp = JSON.parse(JSON.stringify(evenlist));


					// Calculate distance for oddlist and sort
					for (let i = 0; i < oddlist.length; i++)
					{
						oddlist[i]["distance"] = GetDistance(Events[oddlist[i]["index"]]["X"] * event_coords_ratio, 
							Events[oddlist[i]["index"]]["Y"] * event_coords_ratio, unityPosX, unityPosY);
					}
					oddlist.sort((a,b) => (a.distance > b.distance) ? 1 : ((a.distance < b.distance) ? -1 : 0))

					// Same, but for even list.
					for (let i = 0; i < evenlist.length; i++)
					{
						evenlist[i]["distance"] = GetDistance(Events[evenlist[i]["index"]]["X"] * event_coords_ratio, 
							Events[evenlist[i]["index"]]["Y"] * event_coords_ratio, unityPosX, unityPosY);
					}
					evenlist.sort((a,b) => (a.distance > b.distance) ? 1 : ((a.distance < b.distance) ? -1 : 0))

					// Check for change
					let changed = false

					for (let i = 0; i < 15; i++)
					{
						if(oddlist_temp[i]["index"] != oddlist[i]["index"]) changed = true;
					}
					for (let i = 0; i < 15; i++)
					{
						if(evenlist_temp[i]["index"] != evenlist[i]["index"]) changed = true;
					}

					if (changed)
					{
						beforefirstchange = false;
						oddlist_cached = oddlist_temp
						evenlist_cached = evenlist_temp
						last_change_time_ms = current_time_ms
					}
					else
					{
						beforefirstdidnotchange = false;
					}
				}
			}
		}


		// Not sure what this is for
		// last_change_time_ms = last_refresh_time_ms


		let time_elapsed = current_time_ms - last_change_time_ms

		console.log(reordering_menu_alpha);
		if (time_elapsed < fade_out_ms)
		{
			if (!beforeFirstOrderChangeAfterRefresh)
			{
				current_alpha = (1 - time_elapsed / fade_out_ms) * reordering_menu_alpha
			}
		}
		else if (time_elapsed < fade_out_ms + fade_in_ms)
		{
			beforefirstrefresh = false;
			beforeFirstOrderChangeAfterRefresh = false;
			oddlist_cached = oddlist
			evenlist_cached = evenlist
			current_alpha = ((time_elapsed - fade_out_ms) / fade_in_ms) * reordering_menu_alpha
		}
		else
		{
			current_alpha = reordering_menu_alpha;
		}


		// This thing about the second change... I think it might not be needed now?
		/*
		oddlist2 = []
		evenlist2 = []

		for (let i = 0; i < cached_event_ordering.length; i++)
		{
			i % 2 == 0 ? evenlist2.push(cached_event_ordering[i]) : oddlist2.push(cached_event_ordering[i]);
		}

		changed2 = true;
		if (oddlist_cached.length != 0)
		{
			for (let i = 0; i < 15; i++)
			{
				if(oddlist2[i]["index"] != oddlist_cached[i]["index"]) changed2 = false;
			}
			for (let i = 0; i < 15; i++)
			{
				if(evenlist2[i]["index"] != evenlist_cached[i]["index"]) changed2 = false;
			}
		}

		// Limit the alpha to 0 until the alpha changes.
		if (changed2 && beforefirstrefresh && beforefirstchange) {current_alpha = 0;}
		*/


		// Positioning and coloring code, don't have to worry about it.
		ctx.fillStyle = "#eeeeee";

		// Odd on top, even below.
		const full_centering_location_y = 1188
		const centering_location_y = full_centering_location_y / overall_height * startxy.height; 
		font_height = 0;


		var font_size = 40;

		ctx.textAlign = 'left';

		starty = centering_location_y;
		for (let i in evenlist_cached)
		{
			ctx.globalAlpha = clamp(clamp(current_alpha, 0, 1) - i * 0.05, 0, 1);
			var font = "lighter " + font_size + "px Gabriola";
			let font_height = getTextHeight(font).height;
			ctx.font = font;
			var measureText = ctx.measureText(Events[evenlist_cached[i]["index"]]["Name"]);
			ctx.fillText(Events[evenlist_cached[i]["index"]]["Name"], 
				centering_location_x - measureText.width / 2,  starty - font_height / 2);
			starty += (font_size * 1.5);
			font_size -= 2;
		}

		var font_size = 35;
		starty = full_centering_location_y / overall_height * startxy.height - font_size * 1.5;
		for (let i in oddlist_cached)
		{
			ctx.globalAlpha = clamp(clamp(current_alpha, 0, 1) - i * 0.05, 0, 1);
			var font = "lighter " + font_size + "px Gabriola";
			let font_height = getTextHeight(font).height;
			ctx.font = font;
			var measureText = ctx.measureText(Events[oddlist_cached[i]["index"]]["Name"]);
			ctx.fillText(Events[oddlist_cached[i]["index"]]["Name"], 
				centering_location_x - measureText.width / 2, starty - font_height / 2);
			starty -= (font_size * 1.5);
			font_size -= 2;
		}

		ctx.globalAlpha = 1;

		if (oddlist_cached.length != 0 && evenlist_cached != 0)
		{
			//console.log(oddlist_cached);
			var closerEvent = Events[oddlist_cached[0]["index"]]["distance"] < Events[evenlist_cached[0]["index"]]["distance"] ? oddlist_cached[0] : evenlist_cached[0];
			var index = closerEvent["index"];

			// Draw the poem
			DrawPoem(c, index, clamp(current_alpha, 0, 1));
		}

		const full_fps_location_x = 3700
		ctx.font = "lighter " + font_size + "px Gabriola";
		ending_location_x = full_fps_location_x / overall_width * startxy.width + startxy.x;
		ctx.fillText(current_fps, ending_location_x, startxy.y + 30);
	}
}

function RedrawBackground(c)
{
	var ctx = c.getContext("2d");
	var r = GetMainRegion(c);

	//ctx.drawImage(web, r.x, r.y, r.width, r.height);
	ctx.drawImage(decorative, r.x, r.y, r.width, r.height);
	ctx.drawImage(looking_glass, r.x, r.y, r.width, r.height);

	ctx.globalAlpha = 0.5;
	ctx.fillStyle = "#FF0000";
	
	var start = GetMouseCoordsFromBoxNormalizedCoords(c, 0, 0);
	var end = GetMouseCoordsFromBoxNormalizedCoords(c, 1, 1);
  // ctx.fillRect(start.x, start.y, end.x - start.x, end.y - start.y);
  
  ctx.globalAlpha = 1.0;

	ctx.globalAlpha = 0.7;
	ctx.strokeStyle = '#FFFFFF'
	ctx.lineWidth = 2

	startxy = GetMainRegion(c);

	for (let i in Events) {
		// var circle = GetBoxCoordsFromNormalizeds(c, Events[i]["X"] / unity_width, Events[i]["Y"] / unity_height);
	  // var radius = GetBoxCoordsFromNormalizeds(c, (Events[i]["X"] + Events[i]["Radius"]) / unity_width, 0).x - GetBoxCoordsFromNormalizeds(c, Events[i]["X"] / unity_width, 0).x;
		//DrawCircle(ctx, circle.x, circle.y, radius, "#FFFFFF");
		//DrawCross(ctx, circle.x, circle.y, radius / 2, "#FFFFFF");
	}
	ctx.stroke();
	ctx.globalAlpha = 1;

	//DrawScrollArea(c);
	DrawReorderingArea(c)
	DrawScrollingBarArea(c);
}

function DrawScrollingBarArea(c)
{
	DrawPoem(c, cached_poem_index, ordered_menu_poem_alpha);
	DrawBox(c);

	var ctx = c.getContext("2d");
	startxy = GetMainRegion(c);
	r = startxy;
	ctx.drawImage(scrollbackground, r.x, r.y, r.width, r.height);

	// Shadow starts at 340
	// Let font size remain the same
	const full_start_location_x = 340
	starty = startxy.y + 30; // This is where you want the first item to be if you scroll to top.
	font_size = 30;
	starting_location_x = full_start_location_x / overall_width * startxy.width + startxy.x;

	var font = "lighter " + font_size + "px Gabriola";
	ctx.font = font;
	let font_height = getTextHeight(font).height;
	let expected_rectangle_height = 30 + (Events.length - 1) * 2 * font_size + font_height + 30;

	ctx.globalAlpha = ordered_menu_alpha;
	boxNormalized = (boxY - scrollbar_top_pos_y) / (scrollbar_bottom_pos_y - scrollbar_top_pos_y);

	EventHitboxesNormalized = []

	starty = 50 - (boxNormalized * (expected_rectangle_height - startxy.height));
	//console.log("BoxNormalized: " + boxNormalized)
	//console.log("StartY" + starty)
	
	let gradient = ctx.createLinearGradient(starting_location_x, 0, starting_location_x + 350, 0);

	gradient.addColorStop(0, 'rgba(238, 238, 238, 1)');
	gradient.addColorStop(0.5, 'rgba(238, 238, 238, 1)');
	gradient.addColorStop(0.8, 'rgba(238, 238, 238, 0.1)');
	gradient.addColorStop(1, 'rgba(238, 238, 238, 0)');
	ctx.fillStyle = gradient;
	
	ctx.textAlign = 'left';
	for (let i in Events)
	{
		ctx.fillText(Events[i]["Name"], starting_location_x, starty);
		EventHitboxesNormalized.push({
			"x": full_start_location_x / overall_width, 
			"y": (starty - font_size / 2) / startxy.height, 
			"width": ctx.measureText(Events[i]["Name"]).width / startxy.width, 
			"height": font_size / startxy.height});
		starty += (font_size * 2);
	}

	ctx.globalAlpha = 1;
}

function DrawBox(c)
{
	var ctx = c.getContext("2d");
	var r = GetMainRegion(c);
	ctx.globalAlpha = ordered_menu_alpha;

	DrawImageCentered(ctx, scrollBar,
		boxX * r.width + r.x,
		boxY * r.height,
		r.width * box_raw_width / overall_width, 
		r.height * box_raw_height / overall_height
	)
}

let unity_move_speed = 0.035;

let unity_current_pos_x = 0;
let unity_current_pos_y = 0;
let unity_target_pos_x = 0;
let unity_target_pos_y = 0;

// Normalized
let mouse_inbox_current_pos_x = 0;
let mouse_inbox_current_pos_y = 0;
let mouse_inbox_target_pos_x = 0;
let mouse_inbox_target_pos_y = 0;
let mouse_unbounded_pos_x = 0;
let mouse_unbounded_pos_y = 0;

let text_move_speed = 0;


function animate(){
	// console.log("animation");
	let distX = mouse_inbox_target_pos_x - mouse_inbox_current_pos_x;
	let distY = mouse_inbox_target_pos_y - mouse_inbox_current_pos_y;

	mouse_inbox_current_pos_x = mouse_inbox_current_pos_x + (distX * unity_move_speed);
	mouse_inbox_current_pos_y = mouse_inbox_current_pos_y + (distY * unity_move_speed);

	let distAlphaReorder = reordering_menu_alpha_target - reordering_menu_alpha;
	let distAlphaOrder = ordered_menu_alpha_target - ordered_menu_alpha;


	let distPoemAlpha = ordered_menu_poem_alpha_target - ordered_menu_poem_alpha;
	ordered_menu_poem_alpha = ordered_menu_poem_alpha + (distPoemAlpha * alpha_menu_change_speed)


	// Todo: slow the fade in? Yeah.
	if (distAlphaReorder < 0)
	{
		reordering_menu_alpha = reordering_menu_alpha + (distAlphaReorder * alpha_menu_change_speed * 2)
	}
	else
	{
		reordering_menu_alpha = reordering_menu_alpha + (distAlphaReorder * alpha_menu_change_speed)
	}

	ordered_menu_alpha = ordered_menu_alpha + (distAlphaOrder * alpha_menu_change_speed)

	// Drawing stuff, consider moving to animation step
	var c = document.getElementById("canvas");
	var ctx = c.getContext("2d");
	ctx.clearRect(0, 0, c.width, c.height);
	unityPos = getUnityPosition(c, mouse_inbox_current_pos_x, mouse_inbox_current_pos_y)
	ctx.drawImage(unity, unityPos.x, unityPos.y, unity_width, unity_height);
	//console.log(unityPos.x, unityPos.y);
	RedrawBackground(c);
	
	const d = new Date();
	let current_second = d.getSeconds()
	
	if (current_fps_second != current_second)
	{
		current_fps_second = current_second;
		current_fps = frames_kept;
		frames_kept = 0;
	}
	frames_kept++;

	requestAnimationFrame(animate);
}

// Gets the Position of a Mouse Pointer on We Are Unity Native Space
function getUnityPosition(c, mouse_x, mouse_y)
{
	// We need to get the position of the circle, first we need to calculate the y position in the circle
	// x = GetMainRegion...
	// y = GetMainRegion.h / total height * circle_center_y
	var r = GetMainRegion(c);
	circlex = r.x + r.width / 2;
	circley = r.y + circle_center_y / overall_height * r.height; 
	circler = circle_radius / overall_height * r.height;

	// I also need current x, y, in box coords, which I can use to line up.
	var box = GetNormalizedBoxCoordsFromMouseCoords(c, mouse_x, mouse_y);
	//console.log(box.x, box.y);

	// First of all I want to shift image by boxcoords * unity_width, same for height
	// Then I want to do the half shift to center it. 
	var unity_x = circlex + (1 - box.x) * unity_width - unity_width;
	var unity_y = circley + (1 - box.y) * unity_height - unity_height;

	/*
	var buffer = 20;
	if (unity_x > circlex - circler - buffer) {unity_x = circlex - circler - buffer};
	if (unity_x + unity_width < circlex + circler + buffer) {unity_x = circlex + circler - unity_width + buffer}; 
	if (unity_y > circley - circler - buffer) {unity_y = circley - circler - buffer};
	if (unity_y + unity_height < circley + circler + buffer) {unity_y = circley + circler - unity_height + buffer}; 
	*/

	var output = {
	    x: unity_x,
	    y: unity_y,
	};

	return output;
}

//let unity_target_pos_x = 0;
//let unity_target_pos_y = 0;
function getMousePosition(e)
{
	var output = {
		x: e.clientX + document.body.scrollLeft,
		y: e.clientY + document.body.scrollTop
	};

	return output;
}

function onMouseMove(e)
{
	var c = document.getElementById("canvas");
	x = getMousePosition(e).x;
	y = getMousePosition(e).y;
	cachedEvent = e;
	// Drawing stuff, consider moving to animation step

	var ctx = c.getContext("2d");

	mouse_unbounded_pos_x = x;
	mouse_unbounded_pos_y = y;
	
	if (IsInBox(c, x, y) || mouse_inbox_target_pos_x == 0 && mouse_inbox_target_pos_y == 0)
	{
		mouse_inbox_target_pos_x = x;
		mouse_inbox_target_pos_y = y;
	}

	unityPos = getUnityPosition(c, mouse_inbox_target_pos_x, mouse_inbox_target_pos_y)

	last_mouse_move_time_ms = Date.now();
	last_refresh_time_ms = Date.now();

	if (scrollBoxSelected)
	{
		mouse_y = convertHtmlDistanceToNormalizedDistanceY(c, y);
		dy = mouse_y - scrollBoxSelectedPosition.y;
		if (dy > 0)
		{
			boxY = Math.min(scrollBoxSelectedPosition.y + dy, scrollbar_bottom_pos_y);
		}
		else
		{
			boxY = Math.max(scrollBoxSelectedPosition.y + dy, scrollbar_top_pos_y);
		}
	}
}

function onMouseDown(e)
{
	var c = document.getElementById("canvas");
	hitScrollBoxTest(c, e);
}

function onMouseUp(e)
{
	scrollBoxSelected = false;
}

function RedrawCanvas()
{
	var c = document.getElementById("canvas");

	bodyHeight = innerHeight;
	bodyWidth = innerWidth;
	var bodyRatio = bodyWidth / bodyHeight;
	c.width = Math.max(window.innerWidth, min_width)
	c.height = Math.max(window.innerHeight, min_height)

	var ctx = c.getContext("2d");
	ctx.clearRect(0, 0, c.width, c.height);

	/*
	ctx.moveTo(0, 0);
	ctx.lineTo(c.width, c.height);
	// console.log(c.width, c.height);
	ctx.strokeStyle = '#110000'
	ctx.lineWidth = 10
	ctx.stroke();
	*/

	RedrawBackground(c);
}

function onFirstSetup()
{
	console.log( "FirstSetup!" );
	var c = document.getElementById("canvas");
	var coords = GetMouseCoordsFromBoxNormalizedCoords(c, 0.4517, 0.545)
	mouse_inbox_target_pos_x = coords.x;
	mouse_inbox_target_pos_y = coords.y;
}

$( document ).ready(function() {
  console.log( "ready!" );
	document.addEventListener('mousemove', onMouseMove);
	document.addEventListener('mousedown', onMouseDown);
	document.addEventListener('click', onMouseClick);
	document.addEventListener('wheel', onScroll);
	document.addEventListener('mouseup', onMouseUp);
	RedrawCanvas();
	onFirstSetup();
	animate();
});

function onResize(){
	RedrawCanvas();
}

const scrollbar_top_pos_x = 0.1
const scrollbar_top_pos_y = 2.5 / 16
const scrollbar_bottom_pos_x = 0.1
const scrollbar_bottom_pos_y = 13.5 / 16
const box_raw_width = 63;
const box_raw_height = 561;
let boxX = 0.07
let boxY = 0.5
let scrollBoxSelected = false;
let scrollBoxTextSize = 30;
let scrollBoxSelectedPosition = {"x": 0, "y": 0};

function hitScrollBoxTest(c, mouse_pos_raw)
{
	mouse_x = convertHtmlDistanceToNormalizedDistanceX(c, mouse_pos_raw.x)
	mouse_y = convertHtmlDistanceToNormalizedDistanceY(c, mouse_pos_raw.y)
	//console.log("mouse_pos", mouse_x, mouse_y)

	if (!scrollBoxSelected)
	{
		box_left = boxX - convertFullImageDistanceToNormalizedDistanceX(c, box_raw_width) / 2;
		box_right = box_left + convertFullImageDistanceToNormalizedDistanceX(c, box_raw_width);
		box_top = boxY - convertFullImageDistanceToNormalizedDistanceY(c, box_raw_height) / 2;
		box_bottom = box_top + convertFullImageDistanceToNormalizedDistanceY(c, box_raw_height);

		//console.log("left, right, top, bottom: ", box_left, box_right, box_top, box_bottom);

		if (mouse_x < box_right && mouse_x > box_left && mouse_y < box_bottom && mouse_y > box_top && !scrollBoxSelected)
		{
			console.log("selected");
			scrollBoxSelected = true;
			scrollBoxSelectedPosition["x"] = mouse_x;
			scrollBoxSelectedPosition["y"] = mouse_y;
		}
	}
}

function onMouseClick(e)
{
	var c = document.getElementById("canvas");
	hitTextTest(c, e);
	console.log("click")
}

var cached_poem_index = 0;
var poem_change_timer = 0;
function hitTextTest(c, mouse_pos_raw)
{
	mouse_x = convertHtmlDistanceToNormalizedDistanceX(c, mouse_pos_raw.x)
	mouse_y = convertHtmlDistanceToNormalizedDistanceY(c, mouse_pos_raw.y)
	console.log("mouse_pos", mouse_x, mouse_y)

	for (var i = 0; i < Events.length; i++)
	{
		box_left = EventHitboxesNormalized[i].x
		box_right = EventHitboxesNormalized[i].x + EventHitboxesNormalized[i].width
		box_top = EventHitboxesNormalized[i].y
		box_bottom = EventHitboxesNormalized[i].y + EventHitboxesNormalized[i].height

		if (mouse_x < box_right && mouse_x > box_left && mouse_y < box_bottom && mouse_y > box_top)
		{
			console.log("selected");
			console.log(Events[i]["Name"]);
			var coords = GetMouseCoordsFromBoxNormalizedCoords(c, 
				Events[i]["X"] * event_coords_ratio / unity_width, 
				Events[i]["Y"] * event_coords_ratio / unity_height)
			mouse_inbox_target_pos_x = coords.x;
			mouse_inbox_target_pos_y = coords.y;


			ordered_menu_poem_alpha_target = 0
			clearTimeout(poem_change_timer);
			poem_change_timer = setTimeout(
				function(index){
					ordered_menu_poem_alpha_target = 1;
					console.log(ordered_menu_poem_alpha_target);
					cached_poem_index = index;}, 800, i);
		}
	}
}

function convertFullImageDistanceToNormalizedDistanceX(c, value)
{
	return value / overall_width;
}

function convertFullImageDistanceToNormalizedDistanceY(c, value)
{
	return value / overall_height;
}

function convertHtmlDistanceToNormalizedDistanceX(c, value)
{
	return (value - GetMainRegion(c).x) / GetMainRegion(c).width;
}

function convertHtmlDistanceToNormalizedDistanceY(c, value)
{
	return value / GetMainRegion(c).height;
}


function onScroll(e) {
  //e.preventDefault();

  //const dx = e.evt.deltaX;
  const deltaY = e.deltaY;

/*
  const minX = stage.width() - canvasWidth;
  const maxX = 0;

  const x = Math.max(minX, Math.min(layer.x() - dx, maxX));

  const minY = stage.height() - canvasHeight;
  const maxY = 0;

  const y = Math.max(minY, Math.min(layer.y() - dy, maxY));
  layer.position({ x, y });

  const availableHeight = stage.height() - verticalScrollbar.height();
  const vy = (layer.y() / (stage.height() - canvasHeight)) * availableHeight;
  verticalScrollbar.y(vy);

  const availableWidth = stage.width() - horizontalScrollbar.width();

  const hx = (layer.x() / (stage.width() - canvasWidth)) * availableWidth;
  horizontalScrollbar.x(hx);
*/

	var c = document.getElementById("canvas");
	dy = convertHtmlDistanceToNormalizedDistanceY(c, deltaY) / 4;
	console.log(dy)
	if (dy > 0)
	{
		boxY = Math.min(boxY + dy, scrollbar_bottom_pos_y);
	}
	else
	{
		boxY = Math.max(boxY + dy, scrollbar_top_pos_y);
	}
};